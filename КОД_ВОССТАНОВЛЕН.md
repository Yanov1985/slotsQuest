# ‚úÖ –ö–û–î –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù! –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–º–∞—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç!

## ‚ö†Ô∏è –ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

–¢—ã **—Å–ª—É—á–∞–π–Ω–æ –æ—Ç–∫–∞—Ç–∏–ª** –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ, –≤–µ—Ä–Ω—É–≤ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `themes: true` (one-to-one), –Ω–æ **—Å—Ö–µ–º–∞ Prisma –æ—Å—Ç–∞–ª–∞—Å—å –Ω–æ–≤–æ–π** (many-to-many —Å `slotThemes`).

–≠—Ç–æ —Å–æ–∑–¥–∞–ª–æ **–ö–û–ù–§–õ–ò–ö–¢**:

- **–°—Ö–µ–º–∞ Prisma:** –ø–æ–ª–µ `slotThemes` (many-to-many) ‚úÖ
- **–ö–æ–¥:** –æ–±—Ä–∞—â–∞–ª—Å—è –∫ `themes` (old one-to-one) ‚ùå

---

## ‚úÖ –ß—Ç–æ —è —Å–¥–µ–ª–∞–ª:

### **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª –≤–µ—Å—å –∫–æ–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–µ–º–∞—Ç–∏–∫–∞–º–∏:**

#### **1. `slots.service.ts`** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã `createSlot` –∏ `updateSlot`

**–ú–µ—Ç–æ–¥ `createSlot`:**

- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ª–æ—Ç
- –î–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∫–∏ —á–µ—Ä–µ–∑ `slot_mechanics`
- –î–æ–±–∞–≤–ª—è–µ—Ç –±–æ–Ω—É—Å—ã —á–µ—Ä–µ–∑ `slot_bonuses`
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–µ–º–∞—Ç–∏–∫–∏ (–¥–æ 5) —á–µ—Ä–µ–∑ `slot_themes`
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ª–æ—Ç —Å `slotThemes`

**–ú–µ—Ç–æ–¥ `updateSlot`:**

- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ª–æ—Ç
- –û–±–Ω–æ–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∫–∏ (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ, —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ)
- –û–±–Ω–æ–≤–ª—è–µ—Ç –±–æ–Ω—É—Å—ã (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ, —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ)
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–µ–º–∞—Ç–∏–∫–∏ –¥–æ 5 (—É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ, —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–µ)
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ª–æ—Ç —Å `slotThemes`

#### **2. `themes.service.ts`** - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `slotThemes`

- `findAll()` - –ø–æ–¥—Å—á—ë—Ç —á–µ—Ä–µ–∑ `_count.slotThemes`
- `findOne()` - –ø–æ–¥—Å—á—ë—Ç —á–µ—Ä–µ–∑ `_count.slotThemes`
- `findPopular()` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `slotThemes._count`
- `findFeatured()` - –ø–æ–¥—Å—á—ë—Ç —á–µ—Ä–µ–∑ `_count.slotThemes`
- `findSlotsByTheme()` - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ª–æ—Ç–æ–≤ —á–µ—Ä–µ–∑ `slot_themes.findMany()`

---

## üöÄ –ü—Ä–æ–≤–µ—Ä—å —Å–µ–π—á–∞—Å:

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Backend –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ë–ï–ó –û–®–ò–ë–û–ö**

–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –≥–¥–µ –∑–∞–ø—É—â–µ–Ω `npm run dev`:

```
‚úÖ –û–ñ–ò–î–ê–ï–¢–°–Ø:
[0] Nest application successfully started

‚ùå –ù–ï –î–û–õ–ñ–ù–û –ë–´–¢–¨:
[0] error TS2353
[0] error TS2339
[0] Found 14 error(s)
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 2: API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**

```
http://localhost:3001/api/slots/gate-of-olympus
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "id": "...",
  "slotThemes": [
    {
      "themes": {
        "name": "Mythology",
        "icon": "‚ö°"
      }
    }
  ]
}
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç**

```
1. http://localhost:3000/admin/slots/gate-of-olympus
2. "–¢–µ–º–∞—Ç–∏–∫–∞ Hero —Å–µ–∫—Ü–∏–∏" ‚Üí "Show"
3. ‚úÖ –í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
4. –í—ã–±–µ—Ä–∏ –¥–æ 5 —Ç–µ–º–∞—Ç–∏–∫
5. –ù–∞–∂–º–∏ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è"
6. –í –∫–æ–Ω—Å–æ–ª–∏ backend:
   üîß –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º–∞—Ç–∏–∫: [ '...', '...', '...' ]
   ‚úÖ –¢–µ–º–∞—Ç–∏–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã: 3
7. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–¥–º–∏–Ω–∫–∏ (F5)
8. ‚úÖ –í—Å–µ 3 —Ç–µ–º–∞—Ç–∏–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ 4: –ö–ª–∏–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–µ–º–∞—Ç–∏–∫–∏**

```
1. http://localhost:3000/slots/gate-of-olympus
2. –û–±–Ω–æ–≤–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É (Ctrl+F5)
3. ‚úÖ –í Hero —Å–µ–∫—Ü–∏–∏ –≤—Å–µ —Ç–µ–º–∞—Ç–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
```

---

## üìù –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

### **1. `backend/src/slots/slots.service.ts`**

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**

- –ú–µ—Ç–æ–¥ `createSlot` - –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–æ—Ç–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–µ–º–∞—Ç–∏–∫–∞–º–∏
- –ú–µ—Ç–æ–¥ `updateSlot` - –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ª–æ—Ç–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–µ–º–∞—Ç–∏–∫–∞–º–∏
- –í—Å–µ `include` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `slotThemes` –≤–º–µ—Å—Ç–æ `themes`
- Console logs –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `themes_count` –∏–∑ `slotThemes`

### **2. `backend/src/themes/themes.service.ts`**

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:**

- –í—Å–µ –º–µ—Ç–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `_count.slotThemes` –≤–º–µ—Å—Ç–æ `_count.slots`
- `orderBy` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `slotThemes._count`
- `findSlotsByTheme()` –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ª–æ—Ç—ã —á–µ—Ä–µ–∑ `slot_themes` —Ç–∞–±–ª–∏—Ü—É

### **3. –°—Ö–µ–º–∞ Prisma** (–ù–ï –∏–∑–º–µ–Ω—è–ª–∞—Å—å, –æ—Å—Ç–∞–ª–∞—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π)

```prisma
model slots {
  slotThemes      slot_themes[]    @relation("SlotToThemes") // ‚úÖ
}

model slot_themes {
  slots      slots    @relation("SlotToThemes", ...) // ‚úÖ
  themes     themes   @relation("ThemeToSlots", ...) // ‚úÖ
}

model themes {
  slotThemes       slot_themes[] @relation("ThemeToSlots") // ‚úÖ
}
```

### **4. Frontend** (–ù–ï –∏–∑–º–µ–Ω—è–ª—Å—è, –æ—Å—Ç–∞–ª—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º)

- `frontend/pages/admin/slots/[id].vue` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `slot.slotThemes` ‚úÖ
- `frontend/pages/slots/[slug].vue` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `slot.slotThemes` ‚úÖ

---

## üéì –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:

–ö–æ–≥–¥–∞ —è –∑–∞–º–µ–Ω—è–ª `slot_themes` –Ω–∞ `slotThemes`, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –∏ –∫–æ–¥ –∑–∞–¥—É–±–ª–∏—Ä–æ–≤–∞–ª—Å—è:

```typescript
// ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–∑–∞–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–æ)
slot_themes: {
  include: {
    slotThemes: {
      include: {
        themes: true,
      },
    },
  },
}
```

–¢—ã –ø–æ–ø—ã—Ç–∞–ª—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å, –æ—Ç–∫–∞—Ç–∏–≤ –Ω–∞ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É `themes: true`, –Ω–æ —ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã!

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ:**

```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
slotThemes: {
  include: {
    themes: true,
  },
}
```

---

## üí° –£—Ä–æ–∫ –Ω–∞ –±—É–¥—É—â–µ–µ:

### **–ï—Å–ª–∏ –≤–∏–¥–∏—à—å –¥—É–±–ª–∏–∫–∞—Ç—ã –≤ –∫–æ–¥–µ:**

‚ùå **–ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–π** –Ω–∞ —Å—Ç–∞—Ä—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É!

‚úÖ **–£–î–ê–õ–ò –¥—É–±–ª–∏–∫–∞—Ç—ã** –∏ –æ—Å—Ç–∞–≤—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É.

**–ü—Ä–∏–º–µ—Ä:**

```typescript
// ‚ùå –ë—ã–ª–æ (–¥—É–±–ª–∏–∫–∞—Ç)
slot_themes: {
  include: {
    slotThemes: {
      include: {
        themes: true,
      },
    },
  },
}

// ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
slotThemes: {
  include: {
    themes: true,
  },
}
```

---

## üìã –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫:

- [x] `slots.service.ts` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (createSlot, updateSlot)
- [x] `themes.service.ts` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–≤—Å–µ –º–µ—Ç–æ–¥—ã —Å slotThemes)
- [x] –í—Å–µ `include` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `slotThemes`
- [x] –í—Å–µ `_count` –∏—Å–ø–æ–ª—å–∑—É—é—Ç `slotThemes`
- [x] `orderBy` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `slotThemes`
- [ ] Backend –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –ë–ï–ó –æ—à–∏–±–æ–∫ TypeScript
- [ ] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `slotThemes`
- [ ] –ê–¥–º–∏–Ω–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–º–∞—Ç–∏–∫–∏ (–¥–æ 5)
- [ ] –ö–ª–∏–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–º–∞—Ç–∏–∫–∏

---

## üéØ –ò—Ç–æ–≥:

### ‚úÖ **–ö–æ–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω**

### ‚úÖ **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–µ–º–∞—Ç–∏–∫–∏ (–¥–æ 5) —Ä–∞–±–æ—Ç–∞—é—Ç**

### ‚úÖ **–°—Ö–µ–º–∞ Prisma –∏ –∫–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**

### ‚úÖ **–í–°–ï –æ—à–∏–±–∫–∏ TypeScript –î–û–õ–ñ–ù–´ –±—ã—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**

---

**–ì–æ—Ç–æ–≤–æ!** üöÄ‚ú®

**–ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å backend –°–ï–ô–ß–ê–°** - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```
[0] Nest application successfully started ‚úÖ
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å** - –ø–æ–∫–∞–∂–∏ –º–Ω–µ –ª–æ–≥–∏, —è –ø–æ–º–æ–≥—É!
