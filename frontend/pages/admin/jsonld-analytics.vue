<template>
  <div class="min-h-screen bg-[#0A0D14] text-white">
    <!-- Header -->
    <div class="bg-gradient-to-r from-[#8B5CF6]/20 to-[#7C3AED]/20 border-b border-[#353A4A]">
      <div class="container mx-auto px-6 py-8">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-3xl font-bold bg-gradient-to-r from-[#8B5CF6] to-[#EC4899] bg-clip-text text-transparent">
              üìä JSON-LD –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
            </h1>
            <p class="text-gray-400 mt-2">
              –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è SEO
            </p>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∞ –º–∞—Å—Å–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
          <button
            @click="validateAll"
            :disabled="isValidating"
            class="px-6 py-3 bg-gradient-to-r from-[#8B5CF6] to-[#7C3AED] hover:from-[#7C3AED] hover:to-[#6D28D9] text-white rounded-xl font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
          >
            <svg v-if="isValidating" class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <svg v-else class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            {{ isValidating ? '–í–∞–ª–∏–¥–∞—Ü–∏—è...' : '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Å–ª–æ—Ç—ã' }}
          </button>
        </div>
      </div>
    </div>

    <div class="container mx-auto px-6 py-8">
      <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
      <div v-if="loading" class="flex items-center justify-center py-20">
        <div class="text-center">
          <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-[#8B5CF6] border-t-transparent"></div>
          <p class="mt-4 text-gray-400">–ó–∞–≥—Ä—É–∑–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏...</p>
        </div>
      </div>

      <div v-else class="space-y-8">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <!-- –í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤ -->
          <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6 hover:border-[#8B5CF6]/40 transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 bg-[#8B5CF6]/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-[#8B5CF6]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                </svg>
              </div>
            </div>
            <p class="text-gray-400 text-sm">–í—Å–µ–≥–æ —Å–ª–æ—Ç–æ–≤</p>
            <p class="text-3xl font-bold text-white mt-1">{{ analytics.total || 0 }}</p>
          </div>

          <!-- JSON-LD –≤–∫–ª—é—á—ë–Ω -->
          <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6 hover:border-green-500/40 transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <span class="text-xs text-green-400 bg-green-400/10 px-2 py-1 rounded-full">
                {{ analytics.total > 0 ? Math.round((analytics.enabled / analytics.total) * 100) : 0 }}%
              </span>
            </div>
            <p class="text-gray-400 text-sm">JSON-LD –≤–∫–ª—é—á—ë–Ω</p>
            <p class="text-3xl font-bold text-green-400 mt-1">{{ analytics.enabled || 0 }}</p>
          </div>

          <!-- –¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
          <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6 hover:border-yellow-500/40 transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 bg-yellow-500/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
              </div>
            </div>
            <p class="text-gray-400 text-sm">–¢—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏</p>
            <p class="text-3xl font-bold text-yellow-400 mt-1">{{ analytics.needsValidation || 0 }}</p>
          </div>

          <!-- –° –æ—à–∏–±–∫–∞–º–∏ -->
          <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6 hover:border-red-500/40 transition-all duration-300">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 bg-red-500/20 rounded-xl flex items-center justify-center">
                <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
            <p class="text-gray-400 text-sm">–° –æ—à–∏–±–∫–∞–º–∏</p>
            <p class="text-3xl font-bold text-red-400 mt-1">{{ analytics.withErrors || 0 }}</p>
          </div>
        </div>

        <!-- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º -->
        <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6">
          <h2 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
            <svg class="w-6 h-6 text-[#8B5CF6]" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
            </svg>
            –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º
          </h2>

          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
            <div
              v-for="(count, schema) in analytics.schemaDistribution"
              :key="schema"
              class="text-center p-4 bg-[#0A0D14] rounded-xl border border-[#353A4A] hover:border-[#8B5CF6]/40 transition-all duration-300"
            >
              <div class="text-2xl mb-2">
                {{ getSchemaIcon(schema) }}
              </div>
              <p class="text-gray-400 text-sm">{{ schema }}</p>
              <p class="text-xl font-bold text-white mt-1">{{ count }}</p>
              <p class="text-xs text-gray-500">
                {{ analytics.enabled > 0 ? Math.round((count / analytics.enabled) * 100) : 0 }}%
              </p>
            </div>
          </div>
        </div>

        <!-- –¢–∞–±—ã -->
        <div class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl overflow-hidden">
          <!-- –¢–∞–± –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
          <div class="flex border-b border-[#353A4A]">
            <button
              @click="activeTab = 'errors'"
              :class="[
                'flex-1 px-6 py-4 text-sm font-medium transition-all duration-300',
                activeTab === 'errors'
                  ? 'bg-red-500/10 text-red-400 border-b-2 border-red-500'
                  : 'text-gray-400 hover:text-white hover:bg-[#353A4A]/50'
              ]"
            >
              ‚ùå –°–ª–æ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ ({{ slotsWithErrors.length }})
            </button>
            <button
              @click="activeTab = 'needs-validation'"
              :class="[
                'flex-1 px-6 py-4 text-sm font-medium transition-all duration-300',
                activeTab === 'needs-validation'
                  ? 'bg-yellow-500/10 text-yellow-400 border-b-2 border-yellow-500'
                  : 'text-gray-400 hover:text-white hover:bg-[#353A4A]/50'
              ]"
            >
              üîç –¢—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ({{ slotsNeedingValidation.length }})
            </button>
            <button
              @click="activeTab = 'all'"
              :class="[
                'flex-1 px-6 py-4 text-sm font-medium transition-all duration-300',
                activeTab === 'all'
                  ? 'bg-[#8B5CF6]/10 text-[#8B5CF6] border-b-2 border-[#8B5CF6]'
                  : 'text-gray-400 hover:text-white hover:bg-[#353A4A]/50'
              ]"
            >
              üìã –í—Å–µ —Å–ª–æ—Ç—ã ({{ allSlots.length }})
            </button>
          </div>

          <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ -->
          <div class="p-6">
            <!-- –°–ª–æ—Ç—ã —Å –æ—à–∏–±–∫–∞–º–∏ -->
            <div v-if="activeTab === 'errors'">
              <div v-if="slotsWithErrors.length === 0" class="text-center py-12">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                </div>
                <p class="text-gray-400">–û—Ç–ª–∏—á–Ω–æ! –ù–µ—Ç —Å–ª–æ—Ç–æ–≤ —Å –æ—à–∏–±–∫–∞–º–∏ JSON-LD üéâ</p>
              </div>

              <div v-else class="space-y-4">
                <div
                  v-for="slot in slotsWithErrors"
                  :key="slot.id"
                  class="bg-[#0A0D14] rounded-xl p-4 border border-red-500/30 hover:border-red-500/50 transition-all duration-300"
                >
                  <div class="flex items-center justify-between mb-3">
                    <div>
                      <h3 class="font-medium text-white">{{ slot.name }}</h3>
                      <p class="text-sm text-gray-500">{{ slot.slug }}</p>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        @click="validateSingleSlot(slot.id)"
                        class="px-3 py-1 bg-[#8B5CF6]/20 text-[#8B5CF6] rounded-lg text-sm hover:bg-[#8B5CF6]/30 transition-colors"
                      >
                        –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                      </button>
                      <NuxtLink
                        :to="`/admin/slots/${slot.id}`"
                        class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg text-sm hover:bg-blue-500/30 transition-colors"
                      >
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                      </NuxtLink>
                    </div>
                  </div>
                  <div class="bg-red-500/10 rounded-lg p-3">
                    <p class="text-xs text-red-300 font-mono" v-for="(err, idx) in slot.errors" :key="idx">
                      ‚Ä¢ {{ err }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- –¢—Ä–µ–±—É—é—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
            <div v-if="activeTab === 'needs-validation'">
              <div v-if="slotsNeedingValidation.length === 0" class="text-center py-12">
                <div class="w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-4">
                  <svg class="w-8 h-8 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                </div>
                <p class="text-gray-400">–í—Å–µ —Å–ª–æ—Ç—ã –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é! üéâ</p>
              </div>

              <div v-else class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="border-b border-[#353A4A]">
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">–°–ª–æ—Ç</th>
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">Slug</th>
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</th>
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">–î–Ω–µ–π –Ω–∞–∑–∞–¥</th>
                      <th class="text-right py-3 px-4 text-gray-400 font-medium">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      v-for="slot in slotsNeedingValidation.slice(0, 20)"
                      :key="slot.id"
                      class="border-b border-[#353A4A]/50 hover:bg-[#353A4A]/20 transition-colors"
                    >
                      <td class="py-3 px-4 text-white">{{ slot.name }}</td>
                      <td class="py-3 px-4 text-gray-400 font-mono text-sm">{{ slot.slug }}</td>
                      <td class="py-3 px-4 text-gray-400">
                        {{ slot.lastValidated ? formatDate(slot.lastValidated) : '–ù–∏–∫–æ–≥–¥–∞' }}
                      </td>
                      <td class="py-3 px-4">
                        <span
                          :class="[
                            'px-2 py-1 rounded-full text-xs',
                            slot.daysSinceValidation === null ? 'bg-red-500/20 text-red-400' :
                            slot.daysSinceValidation > 30 ? 'bg-yellow-500/20 text-yellow-400' :
                            'bg-green-500/20 text-green-400'
                          ]"
                        >
                          {{ slot.daysSinceValidation === null ? '–ù–∏–∫–æ–≥–¥–∞' : `${slot.daysSinceValidation} –¥–Ω.` }}
                        </span>
                      </td>
                      <td class="py-3 px-4 text-right">
                        <button
                          @click="validateSingleSlot(slot.id)"
                          class="px-3 py-1 bg-[#8B5CF6]/20 text-[#8B5CF6] rounded-lg text-sm hover:bg-[#8B5CF6]/30 transition-colors"
                        >
                          –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                        </button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- –í—Å–µ —Å–ª–æ—Ç—ã -->
            <div v-if="activeTab === 'all'">
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="border-b border-[#353A4A]">
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">–°–ª–æ—Ç</th>
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">JSON-LD</th>
                      <th class="text-left py-3 px-4 text-gray-400 font-medium">–°—Ö–µ–º—ã</th>
                      <th class="text-right py-3 px-4 text-gray-400 font-medium">–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr
                      v-for="slot in allSlots.slice(0, 30)"
                      :key="slot.slotId"
                      class="border-b border-[#353A4A]/50 hover:bg-[#353A4A]/20 transition-colors"
                    >
                      <td class="py-3 px-4">
                        <div>
                          <p class="text-white font-medium">{{ slot.slug }}</p>
                        </div>
                      </td>
                      <td class="py-3 px-4">
                        <span
                          :class="[
                            'px-2 py-1 rounded-full text-xs',
                            slot.enabled ? 'bg-green-500/20 text-green-400' : 'bg-gray-500/20 text-gray-400'
                          ]"
                        >
                          {{ slot.enabled ? '‚úÖ –í–∫–ª—é—á—ë–Ω' : '‚ùå –í—ã–∫–ª—é—á–µ–Ω' }}
                        </span>
                      </td>
                      <td class="py-3 px-4">
                        <div class="flex flex-wrap gap-1">
                          <span
                            v-for="schema in slot.schemas"
                            :key="schema"
                            class="px-2 py-0.5 bg-[#8B5CF6]/20 text-[#8B5CF6] rounded text-xs"
                          >
                            {{ schema }}
                          </span>
                        </div>
                      </td>
                      <td class="py-3 px-4 text-right">
                        <NuxtLink
                          :to="`/admin/slots/${slot.slotId}`"
                          class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg text-sm hover:bg-blue-500/30 transition-colors"
                        >
                          –ù–∞—Å—Ç—Ä–æ–∏—Ç—å
                        </NuxtLink>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç –º–∞—Å—Å–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ -->
        <div
          v-if="validationResult"
          class="bg-gradient-to-br from-[#1B1E26] to-[#252A36] border border-[#353A4A] rounded-2xl p-6"
        >
          <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
            <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
          </h2>

          <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="bg-[#0A0D14] rounded-xl p-4 text-center">
              <p class="text-gray-400 text-sm">–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ</p>
              <p class="text-2xl font-bold text-white">{{ validationResult.validated }}</p>
            </div>
            <div class="bg-[#0A0D14] rounded-xl p-4 text-center">
              <p class="text-gray-400 text-sm">–ü—Ä–æ—à–ª–∏</p>
              <p class="text-2xl font-bold text-green-400">{{ validationResult.passed }}</p>
            </div>
            <div class="bg-[#0A0D14] rounded-xl p-4 text-center">
              <p class="text-gray-400 text-sm">–° –æ—à–∏–±–∫–∞–º–∏</p>
              <p class="text-2xl font-bold text-red-400">{{ validationResult.failed }}</p>
            </div>
            <div class="bg-[#0A0D14] rounded-xl p-4 text-center">
              <p class="text-gray-400 text-sm">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</p>
              <p class="text-2xl font-bold text-[#8B5CF6]">
                {{ validationResult.validated > 0 ? Math.round((validationResult.passed / validationResult.validated) * 100) : 0 }}%
              </p>
            </div>
          </div>

          <button
            @click="validationResult = null"
            class="text-sm text-gray-400 hover:text-white transition-colors"
          >
            –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          </button>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'

// ============================================================================
// üì¶ –°–û–°–¢–û–Ø–ù–ò–ï
// ============================================================================

const loading = ref(true)
const isValidating = ref(false)
const activeTab = ref('errors')

// –î–∞–Ω–Ω—ã–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
const analytics = ref({
  total: 0,
  enabled: 0,
  disabled: 0,
  withErrors: 0,
  needsValidation: 0,
  schemaDistribution: {},
  recentlyValidated: 0,
})

// –°–ø–∏—Å–∫–∏ —Å–ª–æ—Ç–æ–≤
const slotsWithErrors = ref([])
const slotsNeedingValidation = ref([])
const allSlots = ref([])

// –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
const validationResult = ref(null)

// API URL
const API_BASE = 'http://localhost:3001'

// ============================================================================
// üîß –ú–ï–¢–û–î–´
// ============================================================================

/**
 * üìä –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É
 */
const loadAnalytics = async () => {
  try {
    loading.value = true

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    const [analyticsRes, errorsRes, needsValidationRes, summaryRes] = await Promise.all([
      $fetch(`${API_BASE}/api/jsonld/analytics`),
      $fetch(`${API_BASE}/api/jsonld/errors`),
      $fetch(`${API_BASE}/api/jsonld/needs-validation`),
      $fetch(`${API_BASE}/api/jsonld/summary`),
    ])

    // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
    if (analyticsRes.success) {
      analytics.value = analyticsRes
    }

    if (errorsRes.success) {
      slotsWithErrors.value = errorsRes.slots || []
    }

    if (needsValidationRes.success) {
      slotsNeedingValidation.value = needsValidationRes.slots || []
    }

    if (summaryRes.success) {
      allSlots.value = summaryRes.summary || []
    }

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error)
  } finally {
    loading.value = false
  }
}

/**
 * üîÑ –ú–∞—Å—Å–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
 */
const validateAll = async () => {
  if (isValidating.value) return

  try {
    isValidating.value = true

    const result = await $fetch(`${API_BASE}/api/jsonld/validate-all`, {
      method: 'POST',
    })

    if (result.success) {
      validationResult.value = result
      // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      await loadAnalytics()
    }

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –º–∞—Å—Å–æ–≤–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', error)
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å.')
  } finally {
    isValidating.value = false
  }
}

/**
 * ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
 */
const validateSingleSlot = async (slotId: string) => {
  try {
    const result = await $fetch(`${API_BASE}/api/jsonld/${slotId}/validate`, {
      method: 'POST',
    })

    if (result.isValid) {
      alert('‚úÖ –°–ª–æ—Ç –ø—Ä–æ—à—ë–ª –≤–∞–ª–∏–¥–∞—Ü–∏—é!')
    } else {
      alert(`‚ùå –ù–∞–π–¥–µ–Ω–æ –æ—à–∏–±–æ–∫: ${result.errors.length}\n\n${result.errors.join('\n')}`)
    }

    // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    await loadAnalytics()

  } catch (error) {
    console.error('‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–ª–æ—Ç–∞:', error)
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏')
  }
}

/**
 * üé® –ü–æ–ª—É—á–∏—Ç—å –∏–∫–æ–Ω–∫—É —Å—Ö–µ–º—ã
 */
const getSchemaIcon = (schema: string): string => {
  const icons: { [key: string]: string } = {
    Game: 'üéÆ',
    Product: 'üõçÔ∏è',
    Review: '‚≠ê',
    FAQ: '‚ùì',
    HowTo: 'üìã',
    Breadcrumb: 'üçû',
    Video: 'üé¨',
  }
  return icons[schema] || 'üìÑ'
}

/**
 * üìÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
 */
const formatDate = (date: string | Date): string => {
  if (!date) return '–ù–∏–∫–æ–≥–¥–∞'
  return new Date(date).toLocaleDateString('ru-RU', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  })
}

// ============================================================================
// üöÄ LIFECYCLE
// ============================================================================

onMounted(() => {
  loadAnalytics()
})
</script>
